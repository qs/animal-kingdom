{"ast":null,"code":"var _jsxFileName = \"/home/ivan/Projects/hacksupply/animal-kingdom-master/src/SignedIn.js\";\nimport React, { Component } from 'react';\nimport { Switch, Route, Redirect } from 'react-router-dom';\nimport { UserSession } from 'blockstack';\nimport EditMe from './EditMe';\nimport Kingdom from './Kingdom';\nimport NavBar from './NavBar';\nimport OptionsList from './OptionsList';\nimport OtherKingdoms from './OtherKingdoms';\nimport { appConfig, ME_FILENAME } from './constants';\nimport './SignedIn.css';\n\nclass SignedIn extends Component {\n  constructor(props) {\n    super(props);\n    this.userSession = new UserSession({\n      appConfig\n    });\n    this.state = {\n      me: {},\n      savingMe: false,\n      savingKingdown: false,\n      redirectToMe: false //selectedAnimal: false,\n      //selectedTerritory: false\n\n    };\n    this.loadMe = this.loadMe.bind(this);\n    this.saveMe = this.saveMe.bind(this);\n    this.signOut = this.signOut.bind(this);\n  }\n\n  componentWillMount() {\n    this.loadMe();\n  }\n\n  loadMe() {\n    const options = {\n      decrypt: false\n    };\n    this.userSession.getFile(ME_FILENAME, options).then(content => {\n      if (content) {\n        const me = JSON.parse(content);\n        this.setState({\n          me,\n          redirectToMe: false\n        });\n      } else {\n        const me = null;\n        this.setState({\n          me,\n          redirectToMe: true\n        });\n      }\n    });\n  }\n\n  saveMe(me) {\n    this.setState({\n      me,\n      savingMe: true\n    });\n    const options = {\n      encrypt: false\n    };\n    this.userSession.putFile(ME_FILENAME, JSON.stringify(me), options).finally(() => {\n      this.setState({\n        savingMe: false,\n        redirectToMe: false\n      });\n    });\n  }\n\n  signOut(e) {\n    e.preventDefault();\n    this.userSession.signUserOut();\n    window.location = '/';\n  }\n\n  render() {\n    const username = this.userSession.loadUserData().username;\n    const me = this.state.me;\n    const redirectToMe = this.state.redirectToMe;\n\n    if (redirectToMe) {\n      // User hasn't configured her animal\n      if (window.location.pathname !== '/me') {\n        return React.createElement(Redirect, {\n          to: \"/me\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 73\n          },\n          __self: this\n        });\n      }\n    }\n\n    if (window.location.pathname === '/') {\n      return React.createElement(Redirect, {\n        to: \"/kingdom/\".concat(username),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 80\n        },\n        __self: this\n      });\n    }\n\n    return React.createElement(\"div\", {\n      className: \"SignedIn\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 86\n      },\n      __self: this\n    }, React.createElement(NavBar, {\n      username: username,\n      signOut: this.signOut,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 87\n      },\n      __self: this\n    }), React.createElement(Switch, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 88\n      },\n      __self: this\n    }, React.createElement(Route, {\n      path: \"/animals\",\n      render: routeProps => React.createElement(OptionsList, Object.assign({\n        type: \"animals\"\n      }, routeProps, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 92\n        },\n        __self: this\n      })),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 89\n      },\n      __self: this\n    }), React.createElement(Route, {\n      path: \"/territories\",\n      render: routeProps => React.createElement(OptionsList, Object.assign({\n        type: \"territories\"\n      }, routeProps, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 100\n        },\n        __self: this\n      })),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 97\n      },\n      __self: this\n    }), React.createElement(Route, {\n      path: \"/others\",\n      render: routeProps => React.createElement(OtherKingdoms, Object.assign({\n        type: \"territories\"\n      }, routeProps, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 108\n        },\n        __self: this\n      })),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 105\n      },\n      __self: this\n    }), React.createElement(Route, {\n      path: \"/me\",\n      render: routeProps => React.createElement(EditMe, Object.assign({\n        me: me,\n        saveMe: this.saveMe,\n        username: username //selectedAnimal={this.props.selectedAnimal}\n        //selectedTerritory={this.props.selectedAnimal}\n\n      }, routeProps, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 116\n        },\n        __self: this\n      })),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 113\n      },\n      __self: this\n    }), React.createElement(Route, {\n      path: \"/kingdom/\".concat(username),\n      render: routeProps => React.createElement(Kingdom, Object.assign({\n        myKingdom: true,\n        protocol: window.location.protocol,\n        ruler: username,\n        currentUsername: username,\n        realm: window.location.origin.split('//')[1]\n      }, routeProps, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 128\n        },\n        __self: this\n      })),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 125\n      },\n      __self: this\n    }), React.createElement(Route, {\n      path: \"/kingdom/:protocol/:realm/:ruler\",\n      render: routeProps => React.createElement(Kingdom, Object.assign({\n        myKingdom: false,\n        protocol: routeProps.match.params.protocol,\n        realm: routeProps.match.params.realm,\n        ruler: routeProps.match.params.ruler,\n        currentUsername: username\n      }, routeProps, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 140\n        },\n        __self: this\n      })),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 137\n      },\n      __self: this\n    })));\n  }\n\n}\n\nexport default SignedIn;","map":{"version":3,"sources":["/home/ivan/Projects/hacksupply/animal-kingdom-master/src/SignedIn.js"],"names":["React","Component","Switch","Route","Redirect","UserSession","EditMe","Kingdom","NavBar","OptionsList","OtherKingdoms","appConfig","ME_FILENAME","SignedIn","constructor","props","userSession","state","me","savingMe","savingKingdown","redirectToMe","loadMe","bind","saveMe","signOut","componentWillMount","options","decrypt","getFile","then","content","JSON","parse","setState","encrypt","putFile","stringify","finally","e","preventDefault","signUserOut","window","location","render","username","loadUserData","pathname","routeProps","protocol","origin","split","match","params","realm","ruler"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport { Switch, Route, Redirect } from 'react-router-dom'\nimport { UserSession } from 'blockstack'\nimport EditMe from './EditMe'\nimport Kingdom from './Kingdom'\nimport NavBar from './NavBar'\nimport OptionsList from './OptionsList'\nimport OtherKingdoms from './OtherKingdoms'\nimport { appConfig, ME_FILENAME } from './constants'\nimport './SignedIn.css'\n\n\nclass SignedIn extends Component {\n\n  constructor(props) {\n    super(props)\n    this.userSession = new UserSession({ appConfig })\n    this.state = {\n      me: {},\n      savingMe: false,\n      savingKingdown: false,\n      redirectToMe: false\n      //selectedAnimal: false,\n      //selectedTerritory: false\n    }\n\n    this.loadMe = this.loadMe.bind(this)\n    this.saveMe = this.saveMe.bind(this)\n    this.signOut = this.signOut.bind(this)\n  }\n\n  componentWillMount() {\n    this.loadMe()\n  }\n\n  loadMe() {\n    const options = { decrypt: false }\n    this.userSession.getFile(ME_FILENAME, options)\n    .then((content) => {\n      if(content) {\n        const me = JSON.parse(content)\n        this.setState({me, redirectToMe: false})\n      } else {\n        const me = null\n        this.setState({me, redirectToMe: true})\n      }\n    })\n  }\n\n  saveMe(me) {\n    this.setState({me, savingMe: true})\n    const options = { encrypt: false }\n    this.userSession.putFile(ME_FILENAME, JSON.stringify(me), options)\n    .finally(() => {\n      this.setState({savingMe: false, redirectToMe: false})\n    })\n  }\n\n  signOut(e) {\n    e.preventDefault()\n    this.userSession.signUserOut()\n    window.location = '/'\n  }\n\n  render() {\n    const username = this.userSession.loadUserData().username\n    const me = this.state.me\n    const redirectToMe = this.state.redirectToMe\n    if(redirectToMe) {\n      // User hasn't configured her animal\n      if(window.location.pathname !== '/me') {\n        return (\n          <Redirect to=\"/me\" />\n        )\n      }\n    }\n\n    if(window.location.pathname === '/') {\n      return (\n        <Redirect to={`/kingdom/${username}`} />\n      )\n    }\n\n\n    return (\n      <div className=\"SignedIn\">\n      <NavBar username={username} signOut={this.signOut}/>\n      <Switch>\n              <Route\n                path='/animals'\n                render={\n                  routeProps => <OptionsList\n                  type=\"animals\"\n                  {...routeProps} />\n                }\n              />\n              <Route\n                path='/territories'\n                render={\n                  routeProps => <OptionsList\n                  type=\"territories\"\n                  {...routeProps} />\n                }\n              />\n              <Route\n                path='/others'\n                render={\n                  routeProps => <OtherKingdoms\n                  type=\"territories\"\n                  {...routeProps} />\n                }\n              />\n              <Route\n                path='/me'\n                render={\n                  routeProps => <EditMe\n                  me={me}\n                  saveMe={this.saveMe}\n                  username={username}\n                  //selectedAnimal={this.props.selectedAnimal}\n                  //selectedTerritory={this.props.selectedAnimal}\n                  {...routeProps} />\n                }\n              />\n              <Route\n                path={`/kingdom/${username}`}\n                render={\n                  routeProps => <Kingdom\n                  myKingdom={true}\n                  protocol={window.location.protocol}\n                  ruler={username}\n                  currentUsername={username}\n                  realm={window.location.origin.split('//')[1]}\n                  {...routeProps} />\n                }\n              />\n              <Route\n                path='/kingdom/:protocol/:realm/:ruler'\n                render={\n                  routeProps => <Kingdom\n                  myKingdom={false}\n                  protocol={routeProps.match.params.protocol}\n                  realm={routeProps.match.params.realm}\n                  ruler={routeProps.match.params.ruler}\n                  currentUsername={username}\n                  {...routeProps} />\n                }\n              />\n      </Switch>\n      </div>\n    );\n  }\n}\n\nexport default SignedIn\n"]},"metadata":{},"sourceType":"module"}