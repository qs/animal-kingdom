{"ast":null,"code":"var _jsxFileName = \"/home/ivan/Projects/hacksupply/animal-kingdom-master/src/Kingdom.js\";\nimport React, { Component } from 'react';\nimport { Link } from 'react-router-dom';\nimport { UserSession } from 'blockstack';\nimport { jsonCopy, subjectFromKingdomUrl, loadRuler, loadSubjects, resolveSubjects } from './utils';\nimport Subject from './Subject';\nimport { appConfig, SUBJECTS_FILENAME, EXPLORER_URL } from './constants';\nimport './Kingdom.css';\n\nclass Kingdom extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      ruler: {\n        animal: {},\n        territory: {}\n      },\n      subjects: [],\n      value: '',\n      app: \"\".concat(props.protocol, \"//\").concat(props.realm),\n      rulerUsername: props.ruler,\n      clickAdd: false\n    };\n    this.userSession = new UserSession({\n      appConfig\n    });\n    this.addSubject = this.addSubject.bind(this);\n    this.removeSubject = this.removeSubject.bind(this);\n    this.handleChange = this.handleChange.bind(this);\n    this.loadKingdom = this.loadKingdom.bind(this);\n  }\n\n  componentWillMount() {\n    const app = this.state.app;\n    const ruler = this.props.ruler;\n    this.loadKingdom(ruler, app);\n    const search = window.location.search;\n\n    if (search) {\n      const appUrl = search.split('=')[1];\n      this.setState({\n        value: appUrl,\n        clickAdd: true\n      });\n    }\n  }\n\n  componentWillReceiveProps(nextProps) {\n    const nextSubjects = nextProps.subjects;\n\n    if (nextSubjects) {\n      if (nextSubjects.length !== this.state.subjects.length) {\n        this.setState({\n          subjects: jsonCopy(nextSubjects)\n        });\n      }\n\n      resolveSubjects(this, this.userSession, nextSubjects);\n    }\n  }\n\n  handleChange(event) {\n    this.setState({\n      value: event.target.value\n    });\n  }\n\n  loadKingdom(ruler, app) {\n    loadRuler(this.userSession, ruler, app).then(ruler => {\n      if (ruler) {\n        this.setState({\n          ruler\n        });\n      }\n    });\n    loadSubjects(this.userSession, ruler, app).then(subjects => {\n      this.setState({\n        subjects\n      });\n      resolveSubjects(this, this.userSession, subjects);\n    });\n  }\n\n  addSubject(e) {\n    e.preventDefault();\n    const subject = subjectFromKingdomUrl(this.state.value);\n    const subjects = jsonCopy(this.state.subjects);\n    this.setState({\n      value: '',\n      clickAdd: false\n    });\n    subjects.push(subject);\n    this.setState({\n      subjects\n    });\n    this.saveSubjects(subjects);\n  }\n\n  removeSubject(e, index) {\n    e.preventDefault();\n    const subjects = jsonCopy(this.state.subjects);\n    subjects.splice(index, 1); // remove subject at index\n\n    this.setState({\n      subjects\n    });\n    this.saveSubjects(subjects);\n  }\n\n  saveSubjects(subjects) {\n    const options = {\n      encrypt: false\n    };\n    this.userSession.putFile(SUBJECTS_FILENAME, JSON.stringify(subjects), options).finally(() => {\n      if (window.location.search) {\n        window.history.pushState(null, \"\", window.location.href.split(\"?\")[0]);\n      }\n\n      resolveSubjects(this, this.userSession, subjects);\n    });\n  }\n\n  render() {\n    const mine = this.props.myKingdom;\n    const ruler = this.state.ruler;\n    const rulerAnimal = ruler.animal;\n    const rulerTerritory = ruler.territory;\n    const username = this.state.rulerUsername;\n    const subjects = this.state.subjects;\n    const myKingdom = this.props.myKingdom;\n    const app = this.state.app;\n    const clickAdd = this.state.clickAdd;\n    const currentUsername = this.props.currentUsername;\n    return React.createElement(\"div\", {\n      className: \"Kingdom\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 122\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"row\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 123\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"col-lg-12 territory\",\n      style: {\n        backgroundImage: \"url('\".concat(app, \"/territories/\").concat(rulerTerritory.id, \".jpg')\")\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 124\n      },\n      __self: this\n    }, rulerAnimal && rulerAnimal.name ? React.createElement(\"img\", {\n      className: \"rounded-circle\",\n      src: \"\".concat(app, \"/animals/\").concat(rulerAnimal.id, \".jpg\"),\n      alt: rulerAnimal.name,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 129\n      },\n      __self: this\n    }) : React.createElement(\"img\", {\n      className: \"rounded-circle\",\n      src: \"data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==\",\n      alt: \"The Ruler\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131\n      },\n      __self: this\n    }))), React.createElement(\"div\", {\n      className: \"row ruler\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 136\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"col-lg-12\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 137\n      },\n      __self: this\n    }, React.createElement(\"h2\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 138\n      },\n      __self: this\n    }, \"Ruler \", username), rulerAnimal ? React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 140\n      },\n      __self: this\n    }, React.createElement(\"a\", {\n      href: \"\".concat(EXPLORER_URL, \"/name/\").concat(username),\n      target: \"_blank\",\n      rel: \"noopener noreferrer\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 140\n      },\n      __self: this\n    }, username), \" is a \", rulerAnimal.name, \" that rules over the \", rulerTerritory.name, \".\") : React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142\n      },\n      __self: this\n    }, username, \" is an unknown animal that hails from an unknown land.\"), React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 144\n      },\n      __self: this\n    }, mine ? React.createElement(Link, {\n      className: \"btn btn-primary\",\n      to: \"/me\",\n      role: \"button\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 145\n      },\n      __self: this\n    }, \"Edit my animal\") : React.createElement(\"a\", {\n      className: \"btn btn-primary\",\n      href: \"\".concat(window.location.origin, \"/kingdom/\").concat(currentUsername, \"?add=\").concat(app, \"/kingdom/\").concat(username),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146\n      },\n      __self: this\n    }, \"Add ruler to my kingdom\")), React.createElement(\"div\", {\n      className: \"container\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152\n      },\n      __self: this\n    }, React.createElement(\"h2\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153\n      },\n      __self: this\n    }, \"Subjects\"), mine ? React.createElement(\"div\", {\n      className: \"row justify-content-center\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 155\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      id: \"addSubject\",\n      className: \"add-frame col-lg-8\",\n      style: {\n        borderColor: clickAdd ? 'red' : '#f8f9fa'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156\n      },\n      __self: this\n    }, React.createElement(\"form\", {\n      onSubmit: this.addSubject,\n      className: \"input-group\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161\n      },\n      __self: this\n    }, React.createElement(\"input\", {\n      className: \"form-control\",\n      type: \"url\",\n      onChange: this.handleChange,\n      value: this.state.value,\n      required: true,\n      placeholder: \"https://example.com/kingdom/ruler.id\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"input-group-append\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 170\n      },\n      __self: this\n    }, React.createElement(\"input\", {\n      type: \"submit\",\n      className: \"btn btn-primary\",\n      value: \"Add subject\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171\n      },\n      __self: this\n    }))))) : null, React.createElement(\"div\", {\n      className: \"card-deck\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179\n      },\n      __self: this\n    }, subjects.map((subject, index) => {\n      return React.createElement(Subject, {\n        key: index,\n        index: index,\n        subject: subject,\n        removeSubject: this.removeSubject,\n        myKingdom: myKingdom,\n        currentUsername: currentUsername,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 182\n        },\n        __self: this\n      });\n    }))))));\n  }\n\n}\n\nexport default Kingdom;","map":{"version":3,"sources":["/home/ivan/Projects/hacksupply/animal-kingdom-master/src/Kingdom.js"],"names":["React","Component","Link","UserSession","jsonCopy","subjectFromKingdomUrl","loadRuler","loadSubjects","resolveSubjects","Subject","appConfig","SUBJECTS_FILENAME","EXPLORER_URL","Kingdom","constructor","props","state","ruler","animal","territory","subjects","value","app","protocol","realm","rulerUsername","clickAdd","userSession","addSubject","bind","removeSubject","handleChange","loadKingdom","componentWillMount","search","window","location","appUrl","split","setState","componentWillReceiveProps","nextProps","nextSubjects","length","event","target","then","e","preventDefault","subject","push","saveSubjects","index","splice","options","encrypt","putFile","JSON","stringify","finally","history","pushState","href","render","mine","myKingdom","rulerAnimal","rulerTerritory","username","currentUsername","backgroundImage","id","name","origin","borderColor","map"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport { Link } from 'react-router-dom'\nimport { UserSession } from 'blockstack'\nimport { jsonCopy, subjectFromKingdomUrl,\n  loadRuler, loadSubjects, resolveSubjects } from './utils'\nimport Subject from './Subject'\nimport { appConfig, SUBJECTS_FILENAME, EXPLORER_URL } from './constants'\n\nimport './Kingdom.css'\n\nclass Kingdom extends Component {\n\n  constructor(props) {\n    super(props)\n    this.state = {\n      ruler: {\n        animal: {\n\n        },\n        territory: {\n\n        }\n      },\n      subjects: [],\n      value: '',\n      app:`${props.protocol}//${props.realm}`,\n      rulerUsername: props.ruler,\n      clickAdd: false\n    }\n    this.userSession = new UserSession({ appConfig })\n    this.addSubject = this.addSubject.bind(this)\n    this.removeSubject = this.removeSubject.bind(this)\n    this.handleChange = this.handleChange.bind(this)\n    this.loadKingdom = this.loadKingdom.bind(this)\n  }\n\n  componentWillMount() {\n    const app = this.state.app\n    const ruler = this.props.ruler\n    this.loadKingdom(ruler, app)\n    const search = window.location.search\n    if(search) {\n      const appUrl = search.split('=')[1]\n      this.setState({\n        value: appUrl,\n        clickAdd: true\n      })\n    }\n  }\n\n  componentWillReceiveProps(nextProps) {\n    const nextSubjects = nextProps.subjects\n    if(nextSubjects) {\n      if (nextSubjects.length !== this.state.subjects.length) {\n        this.setState({ subjects: jsonCopy(nextSubjects) })\n      }\n      resolveSubjects(this, this.userSession, nextSubjects)\n    }\n  }\n\n\n  handleChange(event) {\n   this.setState({value: event.target.value});\n  }\n\n  loadKingdom(ruler, app) {\n    loadRuler(this.userSession, ruler, app)\n    .then(ruler => {\n      if (ruler) {\n        this.setState({ ruler })\n      }\n    })\n\n    loadSubjects(this.userSession, ruler, app)\n    .then(subjects => {\n      this.setState({ subjects })\n      resolveSubjects(this, this.userSession, subjects)\n    })\n  }\n\n  addSubject(e) {\n    e.preventDefault()\n    const subject = subjectFromKingdomUrl(this.state.value)\n    const subjects = jsonCopy(this.state.subjects)\n    this.setState({value: '', clickAdd: false})\n    subjects.push(subject)\n    this.setState({ subjects })\n    this.saveSubjects(subjects)\n  }\n\n  removeSubject(e, index) {\n    e.preventDefault()\n    const subjects = jsonCopy(this.state.subjects)\n    subjects.splice(index, 1) // remove subject at index\n    this.setState({ subjects })\n    this.saveSubjects(subjects)\n  }\n\n  saveSubjects(subjects) {\n    const options = { encrypt: false }\n    this.userSession.putFile(SUBJECTS_FILENAME, JSON.stringify(subjects), options)\n    .finally(() => {\n      if(window.location.search) {\n        window.history.pushState(null, \"\", window.location.href.split(\"?\")[0])\n      }\n      resolveSubjects(this, this.userSession, subjects)\n    })\n  }\n\n  render() {\n    const mine = this.props.myKingdom\n    const ruler = this.state.ruler\n    const rulerAnimal = ruler.animal\n    const rulerTerritory = ruler.territory\n    const username = this.state.rulerUsername\n    const subjects = this.state.subjects\n    const myKingdom = this.props.myKingdom\n    const app = this.state.app\n    const clickAdd = this.state.clickAdd\n    const currentUsername = this.props.currentUsername\n    return (\n      <div className=\"Kingdom\">\n        <div className=\"row\">\n          <div\n            className=\"col-lg-12 territory\"\n            style={{backgroundImage: `url('${app}/territories/${rulerTerritory.id}.jpg')`}}\n          >\n          { rulerAnimal && rulerAnimal.name ?\n            <img className=\"rounded-circle\" src={`${app}/animals/${rulerAnimal.id}.jpg`} alt={rulerAnimal.name} />\n            :\n            <img className=\"rounded-circle\" src=\"data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==\"\n            alt=\"The Ruler\" />\n          }\n          </div>\n        </div>\n        <div className=\"row ruler\">\n          <div className=\"col-lg-12\">\n            <h2>Ruler {username}</h2>\n            {rulerAnimal ?\n              <p><a href={`${EXPLORER_URL}/name/${username}`} target=\"_blank\" rel=\"noopener noreferrer\">{username}</a> is a {rulerAnimal.name} that rules over the {rulerTerritory.name}.</p>\n              :\n              <p>{username} is an unknown animal that hails from an unknown land.</p>\n            }\n            <p>\n            {mine ? <Link className=\"btn btn-primary\" to=\"/me\" role=\"button\">Edit my animal</Link>\n            : <a\n              className='btn btn-primary'\n              href={`${window.location.origin}/kingdom/${currentUsername}?add=${app}/kingdom/${username}`}\n            >Add ruler to my kingdom\n            </a>}\n            </p>\n            <div className=\"container\">\n              <h2>Subjects</h2>\n              {mine ?\n                <div className=\"row justify-content-center\">\n                  <div\n                    id=\"addSubject\"\n                    className=\"add-frame col-lg-8\"\n                    style={{borderColor: (clickAdd ? 'red' : '#f8f9fa')}}\n                  >\n                    <form onSubmit={this.addSubject} className=\"input-group\">\n                      <input\n                        className=\"form-control\"\n                        type=\"url\"\n                        onChange={this.handleChange}\n                        value={this.state.value}\n                        required\n                        placeholder=\"https://example.com/kingdom/ruler.id\"\n                      />\n                      <div className=\"input-group-append\">\n                        <input type=\"submit\" className=\"btn btn-primary\" value=\"Add subject\"/>\n                      </div>\n                    </form>\n                  </div>\n                </div>\n                :\n                null\n              }\n              <div className=\"card-deck\">\n              {subjects.map((subject, index) => {\n                return (\n                  <Subject\n                    key={index}\n                    index={index}\n                    subject={subject}\n                    removeSubject={this.removeSubject}\n                    myKingdom={myKingdom}\n                    currentUsername={currentUsername}\n                  />\n                      )\n                    })\n              }\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default Kingdom\n"]},"metadata":{},"sourceType":"module"}